<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Number Split Challenge</title>

<!-- ==========  Styles  ========== -->
<style>
/* Cartoon handwriting font (Caveat, ~22 KB) */
@font-face{
  font-family:"Caveat";
  font-weight:400;font-style:normal;
  src:url(data:font/woff2;base64,d09GMgABAAAAACPIAADrAAAAABuAAAAP8AAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHEIGVgCDH...) format('woff2');
}
/* -------- Color & layout -------- */
:root{--bg:#FFF7E8;--orange:#e67e22;--orange-dark:#d35400;--blue:#3498db;--blue-dark:#2980b9;}
body{
  max-width:640px;margin:auto;padding:1rem;background:var(--bg);
  font-family:"Caveat","Comic Sans MS","Baloo","-apple-system",sans-serif;
  font-size:20px;line-height:1.5;color:#333;
}
header{text-align:center;margin-bottom:1rem}
h1{font-size:2.2rem;color:var(--orange);margin-bottom:.2rem}
h2{font-size:1.3rem;color:#555;margin-bottom:.5rem}
#todayStats{font-size:.9rem;color:#2c3e50;margin-bottom:1rem}
/* -------- Config panel -------- */
#config{
  background:#fff;padding:1rem;border-radius:10px;margin-bottom:1rem;
  display:flex;flex-wrap:wrap;gap:.8rem;align-items:center;justify-content:center;
  box-shadow:0 2px 4px rgba(0,0,0,.06)
}
#config label{display:flex;flex-direction:column;font-size:.9rem}
#config input{
  width:80px;padding:.25rem .5rem;margin-top:.25rem;
  border:2px solid #ccc;border-radius:6px;font-size:1rem;font-family:inherit;
}
#generateBtn{
  padding:.55rem 1.4rem;background:var(--blue);color:#fff;border:none;border-radius:8px;
  font-size:1rem;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.15)
}
#generateBtn:hover{background:var(--blue-dark)}
.hidden{display:none!important}
/* -------- Progress bar -------- */
#progress{height:10px;background:#ddd;border-radius:5px;overflow:hidden;margin-bottom:1rem}
#progressBar{height:100%;width:100%;background:#2ecc71;transition:width .2s linear}
/* -------- Questions -------- */
#questionList{list-style:none;padding-left:0;margin-bottom:6rem;
  display:flex;flex-direction:column;gap:1rem}
.question{font-size:1.5rem;display:flex;align-items:center;gap:.4rem;flex-wrap:wrap}
.question input{
  width:90px;text-align:center;padding:.3rem;
  border:2px solid #ccc;border-radius:8px;background:#fff;
  font-size:1.4rem;font-family:inherit
}
.timeSpan{font-size:.75rem;color:#888;margin-left:auto}
.longest .timeSpan{color:#e74c3c;font-weight:bold}
/* -------- Highlight -------- */
.missing input{background:#ffe7e7}
.wrong   input{background:#ffe7e7;border-color:#e74c3c;color:#d10000}
/* -------- Submit button -------- */
#submitBtn{
  position:fixed;left:50%;transform:translateX(-50%);bottom:18px;
  padding:.8rem 2.4rem;background:var(--orange);color:#fff;border:none;border-radius:40px;
  font-size:1.2rem;cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,.15)
}
#submitBtn:hover{background:var(--orange-dark)}
/* -------- Dialog -------- */
.dialog{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:1000}
.dialogContent{
  background:#fff;padding:2rem;border-radius:16px;max-width:90%;text-align:center;
  animation:pop .4s ease-out;box-shadow:0 8px 16px rgba(0,0,0,.2)
}
@keyframes pop{0%{transform:scale(.6);opacity:0}100%{transform:scale(1);opacity:1}}
.dialogContent h3{font-size:2rem;color:#27ae60;margin-bottom:.6rem}
.dialogContent p {font-size:1.1rem;margin-bottom:1.2rem}
.dialogContent button{
  padding:.6rem 1.6rem;background:var(--blue);color:#fff;border:none;border-radius:8px;
  font-size:1rem;cursor:pointer
}
.dialogContent button:hover{background:var(--blue-dark)}
/* -------- Emoji rain -------- */
@keyframes fall{0%{transform:translateY(-10vh) rotate(0);opacity:1}
                100%{transform:translateY(110vh) rotate(360deg);opacity:0}}
.faller{position:fixed;top:-10vh;font-size:2rem;pointer-events:none;animation:fall 6s linear forwards}
</style>
</head>

<body>
<header>
  <h1 id="title">Number Split Challenge</h1>
  <h2 id="subtitle">Break the target into two parts!</h2>
  <div id="todayStats">Today: <span id="playCount">0</span> ｜ Best <span id="bestScore">0</span></div>
</header>

<section id="config">
  <label id="lblTarget">Target Number
    <input id="targetNumber" type="number" min="2" max="50" value="10">
  </label>
  <label id="lblTime">Time Limit (s)
    <input id="timeLimit" type="number" min="30" max="180" value="90">
  </label>
  <button id="generateBtn">Generate</button>
</section>

<section id="quizArea" class="hidden">
  <div id="progress"><div id="progressBar"></div></div>
  <ol id="questionList"></ol>
</section>

<button id="submitBtn" class="hidden">Submit</button>

<!-- Dialog -->
<div id="resultDialog" class="dialog hidden">
  <div class="dialogContent">
    <h3 id="resultTitle">Good Job!</h3>
    <p id="resultDetails"></p>
    <button id="closeDialog">Okay</button>
  </div>
</div>

<!-- ==========  Script  ========== -->
<script>
(() => {
'use strict';

/* -------- i18n dictionary -------- */
const i18n = {
  en: {
    title: 'Number Split Challenge',
    subtitle: 'Break the target into two parts!',
    targetLabel: 'Target Number',
    timeLabel: 'Time Limit (s)',
    btnGenerate: 'Generate',
    btnSubmit: 'Submit',
    todayStats: (count,best)=>`Today: ${count} ｜ Best ${best}`,
    alertFew: n=>`Only ${n} unique splits available.`,
    perfect: 'Perfect!',
    allCorrect:'All correct!',
    overtime: sec=>`Overtime ${sec}s`,
    score: s=>`Score ${s}`,
    time: s=>`Time ${s}s`,
    dialogOK:'Okay'
  },
  zh: {
    title: '数字拆分挑战',
    subtitle: '把目标数拆成两部分！',
    targetLabel: '拆分目标数',
    timeLabel: '时间限制 (秒)',
    btnGenerate: '生成题目',
    btnSubmit: '交卷',
    todayStats: (count,best)=>`今日已练习 ${count} 次 ｜ 最高 ${best}`,
    alertFew: n=>`唯一拆分仅 ${n} 种，本轮题量已减少。`,
    perfect: '满分！太棒啦！',
    allCorrect:'全对！再快一点！',
    overtime: sec=>`超时 ${sec}s`,
    score: s=>`本次得分：${s}`,
    time: s=>`用时 ${s}s`,
    dialogOK:'知道啦'
  }
};

/* Detect browser language */
const lang = (navigator.language||'en').toLowerCase().startsWith('zh') ? 'zh' : 'en';
const t = i18n[lang];

/* ----- DOM refs ----- */
const $ = id => document.getElementById(id);
$('title').textContent   = t.title;
$('title').innerText     = t.title;
$('subtitle').innerText  = t.subtitle;
$('lblTarget').childNodes[0].nodeValue = t.targetLabel+' ';
$('lblTime').childNodes[0].nodeValue   = t.timeLabel+' ';
$('generateBtn').innerText = t.btnGenerate;
$('submitBtn').innerText   = t.btnSubmit;
$('closeDialog').innerText = t.dialogOK;

/* Util */
const randInt = (min,max)=>Math.floor(Math.random()*(max-min+1))+min;
const shuffle = a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;};
const getDateKey = () => new Date().toISOString().slice(0,10);

/* Stats */
let store = JSON.parse(localStorage.getItem('msc')||'{}');
let dateKey=getDateKey();
if(!store[dateKey]) store[dateKey]={count:0,best:0};
const refreshStats=()=>{ $('todayStats').innerText = t.todayStats(store[dateKey].count,store[dateKey].best); };
refreshStats();

/* Other refs */
const targetInput=$('targetNumber'),timeInput=$('timeLimit');
const genBtn=$('generateBtn'),quizArea=$('quizArea'),qList=$('questionList');
const submitBtn=$('submitBtn'),progressBar=$('progressBar');
const dlg=$('resultDialog'),dlgTitle=$('resultTitle'),dlgMsg=$('resultDetails'),dlgClose=$('closeDialog');

/* State */
let timer=null,timeLeft=0,startTime=0,qTimes=[],focusStart=null,curIdx=null,rainTimer=null;
const animals=['🦫','🐰','🐱','🐶','🐼','🐵','🦊','🦝','🦔','🐢','🦄','🐧','🦉'];

/* Rain */
const stopRain=()=>{if(rainTimer){clearInterval(rainTimer);rainTimer=null;}document.querySelectorAll('.faller').forEach(el=>el.remove());};
const startRain=emoji=>{
  stopRain();
  rainTimer=setInterval(()=>{
    const el=document.createElement('span');
    el.textContent=emoji;el.className='faller';
    el.style.left=Math.random()*100+'vw';
    el.style.fontSize=(1+Math.random()*2)+'rem';
    el.style.animationDuration=(5+Math.random()*3)+'s';
    document.body.appendChild(el);setTimeout(()=>el.remove(),8000);
  },250);
};

/* Generate */
function startGame(){
  dateKey=getDateKey();
  if(!store[dateKey]) store[dateKey]={count:0,best:0};
  refreshStats();
  stopRain();if(timer)clearInterval(timer);
  qTimes=[];focusStart=null;curIdx=null;

  const target=Math.max(2,+targetInput.value||10),
        limit=+timeInput.value||90;

  let blanks=shuffle([...Array(target+1).keys()]).slice(0,Math.min(10,target+1));
  if(blanks.length<10) alert(t.alertFew(blanks.length));

  qList.innerHTML='';
  blanks.forEach((blank,idx)=>{
    const shown=target-blank;
    const li=document.createElement('li');
    li.className='question';
    li.innerHTML=`<input type="number" class="ans" data-idx="${idx}" data-ans="${blank}"> + ${shown} = ${target} <span class="timeSpan"></span>`;
    qList.appendChild(li);
  });

  /* focus track */
  qTimes=new Array(blanks.length);
  qList.querySelectorAll('input.ans').forEach(inp=>{
    inp.addEventListener('focus',()=>{
      const idx=+inp.dataset.idx,now=Date.now();
      if(curIdx!==null) qTimes[curIdx]=(qTimes[curIdx]||0)+now-focusStart;
      curIdx=idx;focusStart=now;
    });
  });

  /* UI */
  quizArea.classList.remove('hidden');submitBtn.classList.remove('hidden');dlg.classList.add('hidden');
  timeLeft=limit;progressBar.style.width='100%';progressBar.style.background='#2ecc71';startTime=Date.now();
  timer=setInterval(()=>{
    timeLeft--;const pct=timeLeft/limit*100;
    progressBar.style.width=pct+'%';
    progressBar.style.background=pct<30?'#e74c3c':(pct<60?'#f1c40f':'#2ecc71');
    if(timeLeft<=0){clearInterval(timer);grade();}
  },1000);
}

/* Grade */
function grade(){
  if(timer)clearInterval(timer);
  if(curIdx!==null)qTimes[curIdx]+=Date.now()-focusStart;
  let total=0,allCorrect=true;
  qList.querySelectorAll('input.ans').forEach(inp=>{
    const idx=+inp.dataset.idx,need=+inp.dataset.ans,val=+inp.value;
    if(val===need){total+=10;}else{allCorrect=false;if(inp.value!=='')inp.parentNode.classList.add('wrong');}
    if(inp.value==='')inp.parentNode.classList.add('missing');
    inp.disabled=true;
    const t=qTimes[idx]||0;
    inp.parentNode.querySelector('.timeSpan').textContent=` (${(t/1000).toFixed(1)}s)`;
  });
  const slowIdx=qTimes.indexOf(Math.max(...qTimes.map(t=>t||0)));
  if(slowIdx>=0)qList.children[slowIdx].classList.add('longest');

  /* stats */
  store[dateKey].count++;if(total>store[dateKey].best)store[dateKey].best=total;
  localStorage.setItem('msc',JSON.stringify(store));refreshStats();

  /* dialog */
  const used=((Date.now()-startTime)/1000).toFixed(1);
  const overtime=Math.max(0,used-(+timeInput.value||90)).toFixed(1);
  let emoji='⭐';
  if(allCorrect&&overtime==0){
    dlgTitle.innerText=t.perfect;
    dlgMsg.innerText=t.time(used);
    emoji=animals[randInt(0,animals.length-1)];
  }else if(allCorrect){
    dlgTitle.innerText=t.allCorrect;
    dlgMsg.innerText=`${t.overtime(overtime)} ｜ ${t.score(total)}`;
  }else{
    dlgTitle.innerText=t.score(total);
    dlgMsg.innerText=t.time(used);
  }
  dlg.classList.remove('hidden');submitBtn.classList.add('hidden');
  startRain(emoji);
}

/* Events */
genBtn.addEventListener('click',startGame);
submitBtn.addEventListener('click',grade);
dlgClose.addEventListener('click',()=>dlg.classList.add('hidden'));

})();
</script>
</body>
</html>
