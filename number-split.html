<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Maureen's Math Game â€” æ‹†åˆ†å°æ¸¸æˆ</title>

<!-- ==========  æ ·å¼  ========== -->
<style>
/* æ‰‹å†™å¡é€šå­—ä½“ï¼ˆCaveatï¼Œ22â€¯KB å†…åµŒï¼‰ */
@font-face{
  font-family:"Caveat";
  font-style:normal;font-weight:400;
  src:url(data:font/woff2;base64,d09GMgABAAAAACPIAADrAAAAABuAAAAP8AAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHEIGVgCDHAqDJIH4ATYCJAMQCwoABCAFhG0HdBvsB8gOgPirB0sEDWkDIYHnvfRvf6Yh5MjX+3jcBNnq0KExns+s2ehYxO9qOcFn6KrCQV/a5U7oNPOHeKC0RkDF9DGjio9YpLMdRluVlgP+685l98799r77Uvabahu+tM/Z9x86fQdAQJzXIFgCEhEQkNIOhMRb8GmwFCBXmDmBsK0KLgfhnHdCMzml7q3dD385u9rqnp/6ueL1K+LhX3tpruvytzsNufs4msfzBmmcHPoJ4xJZqJibn7aeXZbdw1rdYrihFx10mSaZTIjZNlpY0xcvf7nobQh4V+Wqx1vLEulOEzTvdRcSWSNKbHlAXzD4LvgcDi7hjDBZPH+X3LBwPJAowWsczyS0kiUDAcLFu5tRWhrvrO7b8Gh5TKXmQo2aKUkMIuxdR+eeHi+jce019H0vPt9/FbOxnU3UFCfs5770ITsbA9E78/zONvC7ioAV/fGQSKZQn7MCNtmwvPITlKeLly6cfnYH3S8fP7zmPNwJO50IiAkRomenEHiJjy+oeu5qmzKPiW+zx0v6+XnNj3D0Yv7nPxXg6Zr+7TNI6gZ1UGEYLFUoUxasJw6MXzMBTzP3Gyl9H2vz1zf177gdr8w6yP/9vvKX6hR+e/k8tPWHX2vAByUMFPn7qrR4368XDzodSt2z3pBdrVQBHxNvcHVN+rp5dgLda6L8u8x2HiN1LbS65Ya69mwolobXbq5YYexCtdv++mp7Tl+flLiHha3ZO6ji0vqWgpCRUdhQsYsNljEkGKwLEo0FZrPeu7sofwD) format('woff2');
}

/* -------- é¢œè‰²ä¸æ’ç‰ˆ -------- */
:root{
  --bg:#FFF7E8;
  --orange:#e67e22; --orange-dark:#d35400;
  --blue:#3498db;   --blue-dark:#2980b9;
}
body{
  max-width:640px;margin:auto;padding:1rem;background:var(--bg);
  font-family:"Caveat","Comic Sans MS","Baloo","Chalkboard","-apple-system",sans-serif;
  font-size:20px;line-height:1.5;color:#333;
}
header{text-align:center;margin-bottom:1rem}
h1{font-size:2.2rem;color:var(--orange);margin-bottom:.2rem}
h2{font-size:1.3rem;color:#555;margin-bottom:.5rem}
#todayStats{font-size:.9rem;color:#2c3e50;margin-bottom:1rem}

/* -------- è®¾ç½®é¢æ¿ -------- */
#config{
  background:#fff;padding:1rem;border-radius:10px;margin-bottom:1rem;
  display:flex;flex-wrap:wrap;gap:.8rem;align-items:center;justify-content:center;
  box-shadow:0 2px 4px rgba(0,0,0,.06)
}
#config label{display:flex;flex-direction:column;font-size:.9rem}
#config input{
  width:80px;padding:.25rem .5rem;margin-top:.25rem;
  border:2px solid #ccc;border-radius:6px;font-size:1rem;font-family:inherit;
}
#generateBtn{
  padding:.55rem 1.4rem;background:var(--blue);color:#fff;
  border:none;border-radius:8px;font-size:1rem;cursor:pointer;
  box-shadow:0 2px 4px rgba(0,0,0,.15)
}
#generateBtn:hover{background:var(--blue-dark)}
.hidden{display:none!important}

/* -------- å€’è®¡æ—¶æ¡ -------- */
#progress{height:10px;background:#ddd;border-radius:5px;overflow:hidden;margin-bottom:1rem}
#progressBar{height:100%;width:100%;background:#2ecc71;transition:width .2s linear}

/* -------- é¢˜ç›®åŒº -------- */
#questionList{list-style:none;padding-left:0;margin-bottom:6rem;
  display:flex;flex-direction:column;gap:1rem}
.question{
  font-size:1.5rem;display:flex;align-items:center;gap:.4rem;flex-wrap:wrap
}
.question input{
  width:90px;text-align:center;padding:.3rem;
  border:3px dashed #aaa;border-radius:10px;
  background:#fffbea;font-size:1.4rem;font-family:inherit
}
.timeSpan{font-size:.75rem;color:#888;margin-left:auto}
.longest .timeSpan{color:#e74c3c;font-weight:bold}

/* -------- é«˜äº®ï¼šæ¼ç­” & é”™ç­” -------- */
.missing input{background:#ffe7e7}
.wrong   input{background:#ffe7e7;border-color:#e74c3c;color:#d10000}

/* -------- äº¤å·æŒ‰é’® -------- */
#submitBtn{
  position:fixed;left:50%;transform:translateX(-50%);bottom:18px;
  padding:.8rem 2.4rem;background:var(--orange);color:#fff;
  border:none;border-radius:40px;font-size:1.2rem;cursor:pointer;
  box-shadow:0 4px 8px rgba(0,0,0,.15)
}
#submitBtn:hover{background:var(--orange-dark)}

/* -------- å¼¹çª— -------- */
.dialog{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:1000}
.dialogContent{
  background:#fff;padding:2rem;border-radius:16px;max-width:90%;text-align:center;
  animation:pop .4s ease-out;box-shadow:0 8px 16px rgba(0,0,0,.2)
}
@keyframes pop{0%{transform:scale(.6);opacity:0}100%{transform:scale(1);opacity:1}}
.dialogContent h3{font-size:2rem;color:#27ae60;margin-bottom:.6rem}
.dialogContent p {font-size:1.1rem;margin-bottom:1.2rem}
.dialogContent button{
  padding:.6rem 1.6rem;background:var(--blue);color:#fff;
  border:none;border-radius:8px;font-size:1rem;cursor:pointer
}
.dialogContent button:hover{background:var(--blue-dark)}

/* -------- å°åŠ¨ç‰©é›¨ -------- */
@keyframes fall{0%{transform:translateY(-10vh) rotate(0deg);opacity:1}
                100%{transform:translateY(110vh) rotate(360deg);opacity:0}}
.faller{
  position:fixed;top:-10vh;font-size:2rem;pointer-events:none;
  animation:fall 6s linear forwards
}
</style>
</head>

<body>
<header>
  <h1>Maureen's Math Game</h1>
  <h2>æ‹†åˆ†å°æ¸¸æˆ</h2>
  <div id="todayStats">ä»Šæ—¥å·²ç»ƒä¹  <span id="playCount">0</span> æ¬¡ ï½œ æœ€é«˜å¾—åˆ† <span id="bestScore">0</span></div>
</header>

<!-- ======== è®¾ç½®é¢æ¿ ======== -->
<section id="config">
  <label>æ‹†åˆ†ç›®æ ‡æ•°
    <input id="targetNumber" type="number" min="2" max="50" value="10">
  </label>
  <label>æ—¶é—´é™åˆ¶ (ç§’)
    <input id="timeLimit" type="number" min="30" max="180" value="90">
  </label>
  <button id="generateBtn">ç”Ÿæˆé¢˜ç›®</button>
</section>

<!-- ======== é¢˜ç›®åŒº ======== -->
<section id="quizArea" class="hidden">
  <div id="progress"><div id="progressBar"></div></div>
  <ol id="questionList"></ol>
</section>

<button id="submitBtn" class="hidden">äº¤å·</button>

<!-- ======== æˆå°±å¼¹çª— ======== -->
<div id="resultDialog" class="dialog hidden">
  <div class="dialogContent">
    <h3 id="resultTitle">Good Job!</h3>
    <p id="resultDetails"></p>
    <button id="closeDialog">çŸ¥é“å•¦</button>
  </div>
</div>

<!-- ==========  è„šæœ¬  ========== -->
<script>
(() => {
'use strict';

/* ===== å·¥å…·å‡½æ•° ===== */
const $        = id => document.getElementById(id);
const randInt  = (min,max)=>Math.floor(Math.random()*(max-min+1))+min;
const shuffle  = arr => {for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;};

/* ===== ä»Šæ—¥ç»Ÿè®¡ (localStorage) ===== */
const dateKey = new Date().toISOString().slice(0,10);
let store = JSON.parse(localStorage.getItem('mmg') || '{}');
if(!store[dateKey]) store[dateKey] = {count:0,best:0};
const refreshStats = () => { $('playCount').textContent = store[dateKey].count; $('bestScore').textContent = store[dateKey].best; };
refreshStats();

/* ===== DOM refs ===== */
const targetInput = $('targetNumber'),
      timeInput   = $('timeLimit'),
      genBtn      = $('generateBtn'),
      quizArea    = $('quizArea'),
      qList       = $('questionList'),
      submitBtn   = $('submitBtn'),
      progressBar = $('progressBar'),
      dlg         = $('resultDialog'),
      dlgTitle    = $('resultTitle'),
      dlgMsg      = $('resultDetails'),
      dlgClose    = $('closeDialog');

/* ===== çŠ¶æ€å˜é‡ ===== */
let timer      = null,
    timeLeft   = 0,
    startTime  = 0,
    qTimes     = [],    // æ¯é¢˜è€—æ—¶ (ms)
    focusStart = null,  // å½“å‰ç„¦ç‚¹èµ·å§‹æ—¶é—´
    curIdx     = null,  // å½“å‰é¢˜åº
    rainTimer  = null;

/* å°åŠ¨ç‰© emoji æ±  */
const animals = ['ğŸ¦«','ğŸ°','ğŸ±','ğŸ¶','ğŸ¼','ğŸµ','ğŸ¦Š','ğŸ¦','ğŸ¦”','ğŸ¢','ğŸ¦„','ğŸ§','ğŸ¦‰'];

/* ===== å°åŠ¨ç‰©é›¨æ§åˆ¶ ===== */
const stopRain = () => {
  if(rainTimer){ clearInterval(rainTimer); rainTimer = null; }
  document.querySelectorAll('.faller').forEach(el => el.remove());
};
const startRain = emoji => {
  stopRain();
  rainTimer = setInterval(()=>{
    const el = document.createElement('span');
    el.textContent = emoji;
    el.className   = 'faller';
    el.style.left  = Math.random()*100 + 'vw';
    el.style.fontSize = (1 + Math.random()*2) + 'rem';
    el.style.animationDuration = (5 + Math.random()*3) + 's';
    document.body.appendChild(el);
    setTimeout(()=>el.remove(),8000);
  },250);
};

/* ============ ç”Ÿæˆé¢˜ç›® ============ */
function startGame(){
  stopRain(); if(timer) clearInterval(timer);

  // åˆå§‹çŠ¶æ€
  qTimes = []; focusStart=null; curIdx=null;

  const target = Math.max(2, +targetInput.value || 10),
        limit  = +timeInput.value   || 90;

  /* å”¯ä¸€æ‹†åˆ†ï¼šç©ºåœ¨ç¬¬1ä½ => (0..target) */
  let blanks = Array.from({length:target+1}, (_,i)=>i); // [0..target]
  blanks = shuffle(blanks);

  if(blanks.length < 10){
    alert('å¯ç”¨æ‹†åˆ†ä»… '+blanks.length+' ç§ï¼Œæœ¬è½®é¢˜é‡å·²å‡å°‘ã€‚');
  }
  blanks = blanks.slice(0, Math.min(10, blanks.length));

  /* æ¸²æŸ“é¢˜ç›® */
  qList.innerHTML = '';
  blanks.forEach((blank, idx)=>{
    const shown = target - blank;
    const li = document.createElement('li');
    li.className = 'question';
    li.innerHTML = `<input type="number" class="ans" data-idx="${idx}" data-ans="${blank}" placeholder="?"> + ${shown} = ${target} <span class="timeSpan"></span>`;
    qList.appendChild(li);
  });

  /* ç„¦ç‚¹è·Ÿè¸ª */
  qTimes = new Array(blanks.length);
  qList.querySelectorAll('input.ans').forEach(inp=>{
    inp.addEventListener('focus', ()=>{
      const idx = +inp.dataset.idx, now = Date.now();
      if(curIdx!==null) qTimes[curIdx] = (qTimes[curIdx]||0) + (now-focusStart);
      curIdx = idx; focusStart = now;
    });
  });

  /* æ˜¾ç¤ºç•Œé¢ & å€’è®¡æ—¶ */
  quizArea.classList.remove('hidden');
  submitBtn.classList.remove('hidden');
  dlg.classList.add('hidden');

  timeLeft = limit;
  progressBar.style.width = '100%'; progressBar.style.background = '#2ecc71';
  startTime = Date.now();

  timer = setInterval(()=>{
    timeLeft--;
    const pct = timeLeft/limit*100;
    progressBar.style.width = pct + '%';
    progressBar.style.background = pct<30 ? '#e74c3c' : (pct<60 ? '#f1c40f' : '#2ecc71');
    if(timeLeft<=0){ clearInterval(timer); grade(); }
  },1000);

  quizArea.scrollIntoView({behavior:'smooth'});
}

/* ============ æ‰¹æ”¹ & ç»“æœ ============ */
function grade(){
  if(timer) clearInterval(timer);
  if(curIdx!==null) qTimes[curIdx] += Date.now()-focusStart;

  let total = 0, allCorrect = true;
  const inputs = qList.querySelectorAll('input.ans');

  inputs.forEach(inp=>{
    const idx  = +inp.dataset.idx,
          need = +inp.dataset.ans,
          val  = +inp.value;

    if(val === need){
      total += 10;
    }else{
      allCorrect = false;
      if(inp.value!=='') inp.parentNode.classList.add('wrong'); // é”™ç­”çº¢è‰²
    }

    if(inp.value==='')  inp.parentNode.classList.add('missing'); // æœªå¡«

    // æ˜¾ç¤ºè€—æ—¶
    const t = qTimes[idx] || 0;
    inp.parentNode.querySelector('.timeSpan').textContent = ` (${(t/1000).toFixed(1)}s)`;

    inp.disabled = true;
  });

  // æœ€æ…¢é¢˜ç‰¹æ®Šæ ‡è®°
  const slowIdx = qTimes.indexOf(Math.max(...qTimes.map(t=>t||0)));
  if(slowIdx >= 0) qList.children[slowIdx].classList.add('longest');

  // æ›´æ–°æœ¬åœ°ç»Ÿè®¡
  store[dateKey].count++;
  if(total > store[dateKey].best) store[dateKey].best = total;
  localStorage.setItem('mmg', JSON.stringify(store));
  refreshStats();

  // ç»“æœå¼¹çª— & é›¨åŠ¨ç”»
  const used     = ((Date.now()-startTime)/1000).toFixed(1);
  const overtime = Math.max(0, used - (+timeInput.value||90)).toFixed(1);
  let emoji      = 'â­';

  if(allCorrect && overtime==0){
    dlgTitle.textContent = 'æ»¡åˆ†ï¼å¤ªæ£’å•¦ï¼';
    dlgMsg.textContent   = `ç”¨æ—¶ ${used}sï¼ç»§ç»­ä¿æŒï¼`;
    emoji = animals[randInt(0,animals.length-1)];
  }else if(allCorrect){
    dlgTitle.textContent = 'å…¨å¯¹ï¼å†å¿«ä¸€ç‚¹ï¼';
    dlgMsg.textContent   = `è¶…æ—¶ ${overtime}sï¼›æ€»åˆ† ${total} åˆ†`;
  }else{
    dlgTitle.textContent = `æœ¬æ¬¡å¾—åˆ†ï¼š${total}`;
    dlgMsg.textContent   = `ç”¨æ—¶ ${used}s`;
  }

  dlg.classList.remove('hidden');
  submitBtn.classList.add('hidden');
  startRain(emoji);
}

/* ============ äº‹ä»¶ç»‘å®š ============ */
genBtn.addEventListener('click', startGame);
submitBtn.addEventListener('click', grade);
dlgClose.addEventListener('click', ()=>dlg.classList.add('hidden'));

})();  // IIFE ç»“æŸ
</script>
</body>
</html>
